const { SlashCommandBuilder, EmbedBuilder, ActionRowBuilder, ButtonBuilder, ButtonStyle, AttachmentBuilder } = require('discord.js');
const { createCanvas, loadImage, registerFont } = require('canvas');
const path = require('path');

// Register Thai font
registerFont(path.join(__dirname, '../fonts/Sarabun-Regular.ttf'), { family: 'Sarabun' });
registerFont(path.join(__dirname, '../fonts/Sarabun-Bold.ttf'), { family: 'Sarabun-Bold' });

module.exports = {
    data: new SlashCommandBuilder()
        .setName('tutorial')
        .setDescription('à¸ªà¸­à¸™à¸§à¸´à¸˜à¸µà¸à¸²à¸£à¹€à¸¥à¹ˆà¸™à¹à¸¥à¸°à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸£à¸°à¸šà¸šà¸•à¹ˆà¸²à¸‡à¹†'),

    async execute(interaction) {
        const pages = {
            main: new EmbedBuilder()
                .setTitle('ðŸŽ® à¸¢à¸´à¸™à¸”à¸µà¸•à¹‰à¸­à¸™à¸£à¸±à¸šà¸ªà¸¹à¹ˆ 100Bath Economy!')
                .setColor('#2b2d31')
                .setDescription('```\nà¹€à¸¥à¸·à¸­à¸à¸«à¸±à¸§à¸‚à¹‰à¸­à¸—à¸µà¹ˆà¸•à¹‰à¸­à¸‡à¸à¸²à¸£à¹€à¸£à¸µà¸¢à¸™à¸£à¸¹à¹‰à¸ˆà¸²à¸à¸›à¸¸à¹ˆà¸¡à¸”à¹‰à¸²à¸™à¸¥à¹ˆà¸²à¸‡\n```')
                .addFields(
                    { name: 'ðŸ’° à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¹ƒà¸Šà¹‰à¸‡à¸²à¸™', value: 'à¹€à¸£à¸µà¸¢à¸™à¸£à¸¹à¹‰à¸žà¸·à¹‰à¸™à¸à¸²à¸™à¸à¸²à¸£à¹€à¸¥à¹ˆà¸™à¹à¸¥à¸°à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¹€à¸šà¸·à¹‰à¸­à¸‡à¸•à¹‰à¸™', inline: true },
                    { name: 'ðŸ’¼ à¸£à¸°à¸šà¸šà¸­à¸²à¸Šà¸µà¸ž', value: 'à¸—à¸³à¸‡à¸²à¸™à¹à¸¥à¸°à¸žà¸±à¸’à¸™à¸²à¸­à¸²à¸Šà¸µà¸žà¸‚à¸­à¸‡à¸„à¸¸à¸“', inline: true },
                    { name: 'ðŸŽ² à¸£à¸°à¸šà¸šà¸à¸²à¸£à¸žà¸™à¸±à¸™', value: 'à¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¹‚à¸Šà¸„à¹à¸¥à¸°à¹€à¸žà¸´à¹ˆà¸¡à¸„à¸§à¸²à¸¡à¸ªà¸™à¸¸à¸', inline: true },  
                    { name: 'ðŸ¦ à¸£à¸°à¸šà¸šà¸˜à¸™à¸²à¸„à¸²à¸£', value: 'à¸à¸²à¸à¹€à¸‡à¸´à¸™à¹à¸¥à¸°à¸£à¸±à¸šà¸”à¸­à¸à¹€à¸šà¸µà¹‰à¸¢', inline: true },
                    { name: 'ðŸ† à¸£à¸°à¸šà¸šà¸„à¸§à¸²à¸¡à¸ªà¸³à¹€à¸£à¹‡à¸ˆ', value: 'à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸„à¸„à¸§à¸²à¸¡à¸ªà¸³à¹€à¸£à¹‡à¸ˆà¸•à¹ˆà¸²à¸‡à¹†', inline: true },
                    { name: 'ðŸ’Ž à¸£à¸°à¸šà¸šà¹€à¸žà¸Šà¸£à¹à¸¥à¸°à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²', value: 'à¸‹à¸·à¹‰à¸­à¹„à¸­à¹€à¸—à¸¡à¹à¸¥à¸°à¸­à¸±à¸žà¹€à¸à¸£à¸”', inline: true }
                )
                .setFooter({ text: 'à¸«à¸™à¹‰à¸² 1/6 â€¢ à¸„à¸¥à¸´à¸à¸›à¸¸à¹ˆà¸¡à¸”à¹‰à¸²à¸™à¸¥à¹ˆà¸²à¸‡à¹€à¸žà¸·à¹ˆà¸­à¸”à¸¹à¸£à¸²à¸¢à¸¥à¸°à¹€à¸­à¸µà¸¢à¸”' }),

            basic: new EmbedBuilder()
                .setTitle('ðŸ’° à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¹ƒà¸Šà¹‰à¸‡à¸²à¸™')
                .setColor('#00ff00')
                .setDescription('```\nà¸„à¸³à¸ªà¸±à¹ˆà¸‡à¸žà¸·à¹‰à¸™à¸à¸²à¸™à¸—à¸µà¹ˆà¸„à¸§à¸£à¸£à¸¹à¹‰\n```')
                .addFields(
                    { name: 'ðŸ“ à¸„à¸³à¸ªà¸±à¹ˆà¸‡à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™', value: 'â€¢ `/start` - à¸ªà¸£à¹‰à¸²à¸‡à¹‚à¸›à¸£à¹„à¸Ÿà¸¥à¹Œà¹à¸¥à¸°à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¹ƒà¸Šà¹‰à¸‡à¸²à¸™\nâ€¢ `/profile` - à¸”à¸¹à¸‚à¹‰à¸­à¸¡à¸¹à¸¥à¹‚à¸›à¸£à¹„à¸Ÿà¸¥à¹Œ\nâ€¢ `/inventory` - à¸”à¸¹à¹„à¸­à¹€à¸—à¸¡à¸—à¸µà¹ˆà¸¡à¸µ', inline: false },
                    { name: 'ðŸ’¹ à¸£à¸°à¸šà¸šà¹€à¸¥à¹€à¸§à¸¥', value: 'à¹€à¸¥à¹€à¸§à¸¥à¸ˆà¸°à¹€à¸žà¸´à¹ˆà¸¡à¸‚à¸¶à¹‰à¸™à¹€à¸¡à¸·à¹ˆà¸­à¸—à¸³à¸à¸´à¸ˆà¸à¸£à¸£à¸¡à¸•à¹ˆà¸²à¸‡à¹†\nà¸¢à¸´à¹ˆà¸‡à¹€à¸¥à¹€à¸§à¸¥à¸ªà¸¹à¸‡ à¸¢à¸´à¹ˆà¸‡à¸›à¸¥à¸”à¸¥à¹‡à¸­à¸„à¸„à¸§à¸²à¸¡à¸ªà¸²à¸¡à¸²à¸£à¸–à¸¡à¸²à¸à¸‚à¸¶à¹‰à¸™', inline: false },
                    { name: 'ðŸ’¡ à¹€à¸„à¸¥à¹‡à¸”à¸¥à¸±à¸š', value: 'à¸—à¸³à¹€à¸„à¸§à¸ªà¸£à¸²à¸¢à¸§à¸±à¸™à¹€à¸žà¸·à¹ˆà¸­à¸£à¸±à¸šà¸£à¸²à¸‡à¸§à¸±à¸¥à¹à¸¥à¸°à¹€à¸žà¸´à¹ˆà¸¡ Streak', inline: false }
                ),

            work: new EmbedBuilder()
                .setTitle('ðŸ’¼ à¸£à¸°à¸šà¸šà¸­à¸²à¸Šà¸µà¸ž') 
                .setColor('#3498db')
                .setDescription('```\nà¸—à¸³à¸‡à¸²à¸™à¹€à¸žà¸·à¹ˆà¸­à¸«à¸²à¹€à¸‡à¸´à¸™à¹à¸¥à¸°à¸žà¸±à¸’à¸™à¸²à¸­à¸²à¸Šà¸µà¸ž\n```')
                .addFields(
                    { name: 'ðŸ“‹ à¸§à¸´à¸˜à¸µà¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™', value: '1. `/work info` - à¸”à¸¹à¸£à¸²à¸¢à¸Šà¸·à¹ˆà¸­à¸­à¸²à¸Šà¸µà¸žà¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”\n2. à¹€à¸¥à¸·à¸­à¸à¸­à¸²à¸Šà¸µà¸žà¸—à¸µà¹ˆà¹€à¸«à¸¡à¸²à¸°à¸à¸±à¸šà¹€à¸¥à¹€à¸§à¸¥\n3. `/work [à¸­à¸²à¸Šà¸µà¸ž]` - à¹€à¸£à¸´à¹ˆà¸¡à¸—à¸³à¸‡à¸²à¸™', inline: false },
                    { name: 'ðŸ“ˆ à¸à¸²à¸£à¸žà¸±à¸’à¸™à¸²', value: 'â€¢ à¸—à¸³à¸‡à¸²à¸™à¹€à¸žà¸·à¹ˆà¸­à¹€à¸žà¸´à¹ˆà¸¡à¹€à¸¥à¹€à¸§à¸¥à¸­à¸²à¸Šà¸µà¸ž\nâ€¢ à¸­à¸²à¸Šà¸µà¸žà¹€à¸¥à¹€à¸§à¸¥à¸ªà¸¹à¸‡à¹ƒà¸«à¹‰à¸£à¸²à¸¢à¹„à¸”à¹‰à¸¡à¸²à¸à¸‚à¸¶à¹‰à¸™\nâ€¢ à¸¡à¸µà¹‚à¸­à¸à¸²à¸ªà¹„à¸”à¹‰à¹„à¸­à¹€à¸—à¸¡à¸žà¸´à¹€à¸¨à¸©', inline: false },
                    { name: 'ðŸ’Ž à¹‚à¸šà¸™à¸±à¸ªà¸žà¸´à¹€à¸¨à¸©', value: 'à¸¡à¸µà¹‚à¸­à¸à¸²à¸ªà¹„à¸”à¹‰à¸£à¸±à¸šà¹€à¸žà¸Šà¸£à¸ˆà¸²à¸à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™', inline: false }
                ),

            gambling: new EmbedBuilder()
                .setTitle('ðŸŽ² à¸£à¸°à¸šà¸šà¸à¸²à¸£à¸žà¸™à¸±à¸™')
                .setColor('#e74c3c')
                .setDescription('```\nà¹€à¸ªà¸µà¹ˆà¸¢à¸‡à¹‚à¸Šà¸„à¹€à¸žà¸·à¹ˆà¸­à¹€à¸žà¸´à¹ˆà¸¡à¸„à¸§à¸²à¸¡à¸ªà¸™à¸¸à¸\n```')
                .addFields(
                    { name: 'ðŸŽ® à¹€à¸à¸¡à¸—à¸µà¹ˆà¹€à¸›à¸´à¸”à¹ƒà¸«à¹‰à¸šà¸£à¸´à¸à¸²à¸£', value: 'â€¢ `/gamble blackjack` - à¹€à¸à¸¡à¹„à¸žà¹ˆà¹à¸šà¸¥à¹‡à¸„à¹à¸ˆà¹‡à¸„\nâ€¢ `/gamble crash` - à¹€à¸à¸¡à¹€à¸žà¸´à¹ˆà¸¡à¸•à¸±à¸§à¸„à¸¹à¸“', inline: false },
                    { name: 'âš ï¸ à¸‚à¹‰à¸­à¸„à¸§à¸£à¸£à¸°à¸§à¸±à¸‡', value: 'â€¢ à¹€à¸£à¸´à¹ˆà¸¡à¸•à¹‰à¸™à¸”à¹‰à¸§à¸¢à¹€à¸‡à¸´à¸™à¹€à¸”à¸´à¸¡à¸žà¸±à¸™à¸™à¹‰à¸­à¸¢à¹†\nâ€¢ à¸§à¸‡à¹€à¸‡à¸´à¸™à¹€à¸”à¸´à¸¡à¸žà¸±à¸™à¸‚à¸¶à¹‰à¸™à¸­à¸¢à¸¹à¹ˆà¸à¸±à¸šà¹€à¸¥à¹€à¸§à¸¥\nâ€¢ à¹€à¸¥à¹ˆà¸™à¸”à¹‰à¸§à¸¢à¸„à¸§à¸²à¸¡à¸£à¸±à¸šà¸œà¸´à¸”à¸Šà¸­à¸š', inline: false }
                ),

            bank: new EmbedBuilder()
                .setTitle('ðŸ¦ à¸£à¸°à¸šà¸šà¸˜à¸™à¸²à¸„à¸²à¸£')
                .setColor('#f1c40f')
                .setDescription('```\nà¸à¸²à¸à¹€à¸‡à¸´à¸™à¹€à¸žà¸·à¹ˆà¸­à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢à¹à¸¥à¸°à¸£à¸±à¸šà¸”à¸­à¸à¹€à¸šà¸µà¹‰à¸¢\n```')
                .addFields(
                    { name: 'ðŸ’° à¸à¸²à¸£à¹ƒà¸Šà¹‰à¸‡à¸²à¸™à¸˜à¸™à¸²à¸„à¸²à¸£', value: 'â€¢ `/bank deposit` - à¸à¸²à¸à¹€à¸‡à¸´à¸™\nâ€¢ `/bank withdraw` - à¸–à¸­à¸™à¹€à¸‡à¸´à¸™\nâ€¢ `/bank balance` - à¹€à¸Šà¹‡à¸„à¸¢à¸­à¸”à¹€à¸‡à¸´à¸™', inline: false },
                    { name: 'ðŸ“ˆ à¸”à¸­à¸à¹€à¸šà¸µà¹‰à¸¢', value: 'à¸£à¸±à¸šà¸”à¸­à¸à¹€à¸šà¸µà¹‰à¸¢ 1% à¸—à¸¸à¸à¸Šà¸±à¹ˆà¸§à¹‚à¸¡à¸‡à¹€à¸¡à¸·à¹ˆà¸­à¸¡à¸µà¹€à¸‡à¸´à¸™à¸à¸²à¸à¸‚à¸±à¹‰à¸™à¸•à¹ˆà¸³ 1,000 à¸šà¸²à¸—', inline: false },
                    { name: 'ðŸ›¡ï¸ à¸„à¸§à¸²à¸¡à¸›à¸¥à¸­à¸”à¸ à¸±à¸¢', value: 'à¹€à¸‡à¸´à¸™à¹ƒà¸™à¸˜à¸™à¸²à¸„à¸²à¸£à¹„à¸¡à¹ˆà¸ªà¸²à¸¡à¸²à¸£à¸–à¸–à¸¹à¸à¸›à¸¥à¹‰à¸™à¹„à¸”à¹‰', inline: false }
                ),

            shop: new EmbedBuilder()
                .setTitle('ðŸ’Ž à¸£à¸°à¸šà¸šà¹€à¸žà¸Šà¸£à¹à¸¥à¸°à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²')
                .setColor('#9b59b6')
                .setDescription('```\nà¸‹à¸·à¹‰à¸­à¹„à¸­à¹€à¸—à¸¡à¹à¸¥à¸°à¸­à¸±à¸žà¹€à¸à¸£à¸”à¸„à¸§à¸²à¸¡à¸ªà¸²à¸¡à¸²à¸£à¸–\n```')
                .addFields(
                    { name: 'ðŸ’Ž à¸à¸²à¸£à¹„à¸”à¹‰à¸£à¸±à¸šà¹€à¸žà¸Šà¸£', value: 'â€¢ à¸—à¸³à¹€à¸„à¸§à¸ªà¸£à¸²à¸¢à¸§à¸±à¸™\nâ€¢ à¸£à¸²à¸‡à¸§à¸±à¸¥ Streak\nâ€¢ à¹‚à¸­à¸à¸²à¸ªà¹„à¸”à¹‰à¸ˆà¸²à¸à¸à¸²à¸£à¸—à¸³à¸‡à¸²à¸™', inline: false },
                    { name: 'ðŸª à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²', value: '`/shop` à¹€à¸žà¸·à¹ˆà¸­à¸”à¸¹à¸ªà¸´à¸™à¸„à¹‰à¸²à¸—à¸±à¹‰à¸‡à¸«à¸¡à¸”', inline: false },
                    { name: 'ðŸ“¦ à¸›à¸£à¸°à¹€à¸ à¸—à¹„à¸­à¹€à¸—à¸¡', value: 'â€¢ à¹„à¸­à¹€à¸—à¸¡à¸–à¸²à¸§à¸£ - à¹ƒà¸Šà¹‰à¹„à¸”à¹‰à¸•à¸¥à¸­à¸”\nâ€¢ à¹„à¸­à¹€à¸—à¸¡à¸Šà¸±à¹ˆà¸§à¸„à¸£à¸²à¸§ - à¸¡à¸µà¹€à¸§à¸¥à¸²à¸«à¸¡à¸”à¸­à¸²à¸¢à¸¸\nâ€¢ à¸¢à¸¨à¸žà¸´à¹€à¸¨à¸© - à¹à¸ªà¸”à¸‡à¸ªà¸–à¸²à¸™à¸°', inline: false }
                )
        };

        // à¸ªà¸£à¹‰à¸²à¸‡à¸›à¸¸à¹ˆà¸¡à¸™à¸³à¸—à¸²à¸‡
        const navigation = new ActionRowBuilder()
            .addComponents(
                new ButtonBuilder()
                    .setCustomId('main')
                    .setLabel('à¸«à¸™à¹‰à¸²à¸«à¸¥à¸±à¸')
                    .setStyle(ButtonStyle.Primary),
                new ButtonBuilder()
                    .setCustomId('basic')
                    .setLabel('à¸žà¸·à¹‰à¸™à¸à¸²à¸™')
                    .setStyle(ButtonStyle.Secondary),
                new ButtonBuilder()
                    .setCustomId('work')
                    .setLabel('à¸­à¸²à¸Šà¸µà¸ž')
                    .setStyle(ButtonStyle.Secondary),
                new ButtonBuilder()
                    .setCustomId('gambling')
                    .setLabel('à¸à¸²à¸£à¸žà¸™à¸±à¸™')
                    .setStyle(ButtonStyle.Secondary),
                new ButtonBuilder()
                    .setCustomId('shop')
                    .setLabel('à¸£à¹‰à¸²à¸™à¸„à¹‰à¸²')
                    .setStyle(ButtonStyle.Secondary)
            );

        const bankNav = new ActionRowBuilder()
            .addComponents(
                new ButtonBuilder()
                    .setCustomId('bank')
                    .setLabel('à¸˜à¸™à¸²à¸„à¸²à¸£')
                    .setStyle(ButtonStyle.Secondary)
            );

        const response = await interaction.reply({
            embeds: [pages.main],
            components: [navigation, bankNav],
            fetchReply: true
        });

        // à¸ªà¸£à¹‰à¸²à¸‡ collector à¸ªà¸³à¸«à¸£à¸±à¸šà¸›à¸¸à¹ˆà¸¡à¸à¸”
        const collector = response.createMessageComponentCollector({
            time: 300000 // 5 minutes
        });

        collector.on('collect', async i => {
            if (i.user.id !== interaction.user.id) {
                return i.reply({
                    content: 'âŒ à¸à¸£à¸¸à¸“à¸²à¹ƒà¸Šà¹‰à¸„à¸³à¸ªà¸±à¹ˆà¸‡ /tutorial à¸‚à¸­à¸‡à¸„à¸¸à¸“à¹€à¸­à¸‡',
                    ephemeral: true
                });
            }

            // à¸­à¸±à¸žà¹€à¸”à¸— embed à¸•à¸²à¸¡à¸›à¸¸à¹ˆà¸¡à¸—à¸µà¹ˆà¸à¸”
            await i.update({
                embeds: [pages[i.customId]],
                components: [navigation, bankNav]
            });
        });

        collector.on('end', () => {
            navigation.components.forEach(button => button.setDisabled(true));
            bankNav.components.forEach(button => button.setDisabled(true));
            interaction.editReply({
                components: [navigation, bankNav]
            }).catch(() => {});
        });
    }
};